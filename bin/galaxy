#!/usr/bin/env bash
set -eo pipefail

if [ -L $0 ]; then
    ROOT=$(cd $(dirname $(readlink -e $0))/..; pwd)
else
    ROOT=$(cd $(dirname $0)/..; pwd)
fi

if ! hash ansible-galaxy 2>/dev/null; then
    echo "Failed to detect ansible-galaxy!"
    exit 1
fi

pushd ${ROOT} >/dev/null
    ansible-galaxy \
        collection install \
        -r ${ROOT}/ansible/collections.yml \
        -p ${ROOT}/ansible/collections \
        "$@"

    ansible-galaxy \
        role install \
        -r ${ROOT}/ansible/requirements.yml \
        -p ${ROOT}/ansible/requirements \
        "$@"
popd >/dev/null
